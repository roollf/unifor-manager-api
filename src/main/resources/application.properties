# Application
quarkus.application.name=unifor-manager

# PostgreSQL
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=unifor
quarkus.datasource.password=unifor
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/unifor_manager
quarkus.hibernate-orm.database.generation=none

# Flyway
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration

# OIDC / Keycloak (Phase 4)
# Required Keycloak setup: realm "unifor", client "unifor-manager" (public), roles "coordinator" and "student" (PRD Appendix B)
# User mapping: users.email must match Keycloak user email (AC-05)
quarkus.oidc.auth-server-url=http://localhost:8081/realms/unifor
quarkus.oidc.client-id=unifor-manager

# OpenAPI (include Swagger UI in prod so /q/swagger-ui works when running via Docker)
quarkus.swagger-ui.always-include=true
quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.path=/q/swagger-ui

# CORS: allow Angular frontend at http://localhost:4200 to call the API
quarkus.http.cors.enabled=true
quarkus.http.cors.origins=http://localhost:4200

# Permit root (redirect to Swagger) and OpenAPI without auth
quarkus.http.auth.permission.root.paths=/
quarkus.http.auth.permission.root.policy=permit
# Permit health and OpenAPI without auth (for dev and probes)
quarkus.http.auth.permission.health.paths=/api/health,/q/health,/q/health/*
quarkus.http.auth.permission.health.policy=permit
quarkus.http.auth.permission.openapi.paths=/q/openapi,/q/swagger-ui,/q/swagger-ui/*
quarkus.http.auth.permission.openapi.policy=permit
quarkus.http.auth.permission.seed-validation.paths=/api/dev/seed-validation
quarkus.http.auth.permission.seed-validation.policy=permit

# Development profile overrides (optional: same DB; tune OIDC if needed)
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/unifor_manager
%dev.quarkus.log.level=DEBUG
# Allow dev to start when migration checksums changed (e.g. after sequence sync edits)
%dev.quarkus.flyway.validate-on-migrate=false

# --- STUB AUTH (Phase 4) - NOT FOR PRODUCTION ---
# Use when Keycloak is not running locally: mvn quarkus:dev -Dquarkus.profile=dev-without-keycloak
# API endpoints permit all; CurrentUserService uses X-Test-User-Email header or principal for user resolution.
# SECURITY: Never enable this profile in production.
%dev-without-keycloak.quarkus.oidc.enabled=false
%dev-without-keycloak.quarkus.flyway.validate-on-migrate=false
%dev-without-keycloak.quarkus.http.auth.permission.authenticated.paths=/api/coordinator/*,/api/student/*
%dev-without-keycloak.quarkus.http.auth.permission.authenticated.policy=permit
